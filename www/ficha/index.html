<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ficha de Personaje</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/ficha/style.css">
    <link rel="icon" href="/static/favicon.png" type="image/png" />

</head>

<body>
    <div class="nav-bar">
        <span class="nav-item active">FICHA</span>
        <a class="nav-item" id="conexiones-link">CONEXIONES</a>

        <div class="nav-item dropdown">
            IAs
            <div class="dropdown-content">
                <a href="#" id="hada-link">Hada</a>
                <a href="#" id="eidolon-link">Eidolon</a>
                <a href="#" id="fantasma-link">Fantasma</a>
                <a href="#" id="anima-link">Anima</a>
            </div>
        </div>
    </div>

    <script>
        const id = new URLSearchParams(window.location.search).get("id");
        if (id) {
            document.getElementById("conexiones-link")?.setAttribute("href", `/conexiones?id=${id}`);
            document.getElementById("hada-link").href = `/hada?id=${id}`;
            document.getElementById("eidolon-link").href = `/eidolon?id=${id}`;
            document.getElementById("fantasma-link").href = `/fantasma?id=${id}`;
            document.getElementById("anima-link").href = `/anima?id=${id}`;
        }
    </script>



    <div class="ficha-terminal">
        <div class="scanline"></div>
        <div class="ficha-header">
            ▶ FICHA DE PERSONAJE // ID: <span class="char-id" id="char-id">Cargando...</span>
        </div>
        <div class="ficha-body" id="ficha-contenido">
            Cargando datos...
        </div>
    </div>

    <script>
        window.addEventListener("DOMContentLoaded", async () => {
            const params = new URLSearchParams(window.location.search);
            const id = params.get("id") || "desconocido";
            document.getElementById("char-id").textContent = id.toUpperCase();

            try {
                const res = await fetch(`/ficha/personajes/${id}.json`)

                const data = await res.json();

                const contenido = document.getElementById("ficha-contenido");
                contenido.innerHTML = `
      <div class="ficha-line"><span class="label">Nombre:</span> ${data.nombre}</div>
      <div class="ficha-line"><span class="label">Estado:</span> ${data.estado}</div>
      <div class="ficha-line"><span class="label">Afiliación:</span> ${data.afiliacion}</div>
      <div class="ficha-line"><span class="label">Relaciones:</span> ${data.relaciones.join(', ')}</div>
      <div class="ficha-line"><span class="label">Nivel de amenaza:</span> ${data.nivel_amenaza}</div>
      <div class="ficha-log-title">⧉ LOG DE EVENTOS RECIENTES:</div>
      <ul class="ficha-log">
        ${data.log.map(l => `<li>${l}</li>`).join('')}
      </ul>
    `;
            } catch (e) {
                document.getElementById("ficha-contenido").textContent = "Error al cargar los datos.";
                console.error("Error al cargar el JSON:", e);
            }
        });

        document.addEventListener("DOMContentLoaded", () => {
    const dropdown = document.querySelector(".dropdown");
    const dropdownContent = document.querySelector(".dropdown-content");

    if (dropdown && dropdownContent) {
      // Mostrar/ocultar al hacer clic
      dropdown.addEventListener("click", (e) => {
        e.stopPropagation(); // Evita que se cierre al hacer clic dentro
        dropdown.classList.toggle("active");
        dropdownContent.classList.toggle("show");
      });

      // Cierra el menú al hacer clic fuera
      document.addEventListener("click", (e) => {
        if (!dropdown.contains(e.target)) {
          dropdown.classList.remove("active");
          dropdownContent.classList.remove("show");
        }
      });

      // Cierra con la tecla Escape
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          dropdown.classList.remove("active");
          dropdownContent.classList.remove("show");
        }
      });
    }
  });


    </script>
</body>

</html>