<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Notas Personales</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/notas/style.css"> <!-- Estilos específicos de notas -->
    <link rel="icon" href="/static/favicon.png" type="image/png" />
</head>

<body>

    <div class="nav-bar">
        <a class="nav-item" id="ficha-link" href="/ficha">FICHA</a>
        <a class="nav-item" id="tramas-link" href="/tramas" style="display:none;">TRAMAS</a>
        <a class="nav-item active" id="notas-link" href="/notas">NOTAS</a>
        <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
        <div id="admin-link-container" style="display:none;">
            <a class="nav-item" href="/admin">ADMIN</a>
        </div>

        <div class="nav-item dropdown" id="ia-dropdown-container" style="display:none;">
            IAs
            <div class="dropdown-content" id="ia-dropdown">
                <!-- Links dinámicos a IAs -->
            </div>
        </div>
    </div>

    <script>
        window.addEventListener("DOMContentLoaded", async () => {
            try {
                const sessionRes = await fetch("/session-info");
                const sessionData = await sessionRes.json();
                const id = sessionData.usuario;
                const rol = sessionData.rol;

                if (id) {
                    document.getElementById("tramas-link").setAttribute("href", `/tramas`);

                    if (rol === "admin") {
                        document.getElementById("admin-link-container").style.display = "inline-block";
                    }

                    const usosRes = await fetch("/usos");
                    if (usosRes.ok) {
                        const usos = await usosRes.json();
                        const iaDropdown = document.getElementById("ia-dropdown");
                        const iaDropdownContainer = document.getElementById("ia-dropdown-container");

                        const ias = ["hada", "eidolon", "fantasma", "anima"];
                        let tieneIAsDisponibles = false;

                        ias.forEach(ia => {
                            const cantidad = usos[ia];
                            if (cantidad === -1 || (typeof cantidad === "number" && cantidad >= 0)) {
                                const link = document.createElement("a");
                                link.href = `/${ia}`;
                                link.textContent = ia.charAt(0).toUpperCase() + ia.slice(1);
                                iaDropdown.appendChild(link);
                                tieneIAsDisponibles = true;
                            }
                        });

                        if (tieneIAsDisponibles) {
                            iaDropdownContainer.style.display = "inline-block";
                        }
                    }
                }

                // Dropdown toggle al hacer clic
                const dropdown = document.getElementById("ia-dropdown-container");
                <!DOCTYPE html>
                <html lang="es">
                <head>
                  <meta charset="utf-8" />
                  <meta http-equiv="refresh" content="0; url=/poderes" />
                  <title>Redirigiendo a Poderes</title>
                  <link rel="icon" href="/static/favicon.png" type="image/png" />
                </head>
                <body>
                  Redirigiendo a <a href="/poderes">/poderes</a>...
                </body>
                </html>